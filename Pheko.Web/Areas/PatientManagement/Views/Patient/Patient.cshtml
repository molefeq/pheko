@using Pheko.WebPresentation.ViewModels;
@using Pheko.WebPresentation.Utility;

@model PatientViewModel

@{
    ViewBag.Title = "Patient";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section scripts{
    <script src="@Url.Content("~/Scripts/Pheko/PhekoModels/patientviewmodel.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/Pheko/Patient/patient.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/Pheko/Utilities/phekodatepicker.js")"></script>
}

<div id="divPatientDetails">
    <form class="form-horizontal" id="frmSavePatient" enctype="multipart/form-data" method="post">
        <div class="panel panel-primary">
            <div class="panel-heading">
                Patient Details
            </div>
            <div class="panel-body">
                <div class="form-group">
                    @Html.Label("Patient Id", new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.Label("lblPatientId", new { data_bind = "text: patient.PatientId" })
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.Title, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @foreach (SelectListItem title in ViewBag.Titles)
                            {
                                bool selected = Model.Title == title.Value;
                                @Html.RadioButtonFor(model => model.Title, title.Value, new { data_bind = "checked: patient.Title" }) @title.Text          
                            }
                        </div>
                        @Html.ValidationMessageFor(model => model.Title)
                    </div>
                    @Html.Label("Physical Address", new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.PhysicalAddress.Line1, new { @class = "form-control", data_bind = "value: patient.PhysicalAddress.Line1" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PhysicalAddress.Line1)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.FirstName, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.FirstName, new { @class = "form-control", data_bind = "value: patient.FirstName" })
                        </div>
                        @Html.ValidationMessageFor(model => model.FirstName)
                    </div>
                    <div class="col-sm-offset-2 col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.PhysicalAddress.Line2, new { @class = "form-control", data_bind = "value: patient.PhysicalAddress.Line2" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PhysicalAddress.Line2)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.MiddleName, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.MiddleName, new { @class = "form-control", data_bind = "value: patient.MiddleName" })
                        </div>
                        @Html.ValidationMessageFor(model => model.MiddleName)
                    </div>
                    <div class="col-sm-offset-2 col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.PhysicalAddress.Suburb, new { @class = "form-control", data_bind = "value: patient.PhysicalAddress.Suburb" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PhysicalAddress.Suburb)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.LastName, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.LastName, new { @class = "form-control", data_bind = "value: patient.LastName" })
                        </div>
                        @Html.ValidationMessageFor(model => model.LastName)
                    </div>
                    @Html.Label("Code", new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.PhysicalAddress.PostalCode, new { @class = "form-control", data_bind = "value: patient.PhysicalAddress.PostalCode" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PhysicalAddress.PostalCode)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.IDType, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @foreach (SelectListItem idType in ViewBag.IdTypes)
                            {
                                bool selected = Model.IDType == idType.Value;
                                @Html.RadioButtonFor(model => model.IDType, idType.Value, new { data_bind = "checked: patient.IDType" }) @idType.Text          
                            }
                        </div>
                    </div>
                    <div class="col-sm-offset-2 col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.PhysicalAddress.City, new { @class = "form-control", data_bind = "value: patient.PhysicalAddress.City" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PhysicalAddress.City)
                    </div>
                </div>
                <div class="form-group" id="divPatientModel_IDNumber">
                    @Html.LabelFor(model => model.IDNumber, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.IDNumber, new { @class = "form-control", data_bind = "value: patient.IDNumber" })
                        </div>
                        @Html.ValidationMessageFor(model => model.IDNumber)
                    </div>
                    <div class="col-sm-offset-2 col-sm-4">
                        <div class="col-xs-8">
                            @Html.DropDownListFor(model => model.PhysicalAddress.ProvinceId, ViewBag.Provinces as SelectList, "-- Please select a province --", new { id = "ddlPhysicalAddressProvinceId", @class = "form-control", data_bind = "value: patient.PhysicalAddress.ProvinceId" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PhysicalAddress.ProvinceId)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.BirthDate, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            <div class="input-group date">
                                @Html.TextBoxFor(model => model.BirthDate, new { @class = "form-control", data_bind = "value: patient.BirthDate" })
                                <span class="input-group-addon">
                                    <i class="glyphicon glyphicon-th"></i>
                                </span>
                            </div>
                        </div>
                        @Html.ValidationMessageFor(model => model.BirthDate)
                    </div>
                    @Html.Label("Postal Address", new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.PostalAddress.Line1, new { @class = "form-control", data_bind = "value: patient.PostalAddress.Line1" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PostalAddress.Line1)
                        @Html.ValidationMessage("PostalAddress")
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.Gender, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @foreach (SelectListItem genders in ViewBag.Genders)
                            {
                                @Html.RadioButtonFor(model => model.Gender, genders.Value, new { data_bind = "checked: patient.Gender" }) @genders.Text          
                            }
                        </div>
                        @Html.ValidationMessageFor(model => model.Gender)
                    </div>
                    <div class="col-sm-offset-2 col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.PostalAddress.Line2, new { @class = "form-control", data_bind = "value: patient.PostalAddress.Line2" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PostalAddress.Line2)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.MaritalStatus, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @foreach (SelectListItem maritalStatus in ViewBag.MaritalStatuses)
                            {
                                bool selected = Model.MaritalStatus == maritalStatus.Value;
                                @Html.RadioButtonFor(model => model.MaritalStatus, maritalStatus.Value, new { data_bind = "checked: patient.MaritalStatus" }) @maritalStatus.Text          
                            }
                        </div>
                        @Html.ValidationMessageFor(model => model.MaritalStatus)
                    </div>
                    <div class="col-sm-offset-2 col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.PostalAddress.Suburb, new { @class = "form-control", data_bind = "value: patient.PostalAddress.Suburb" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PostalAddress.Suburb)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.EthnicGroup, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @foreach (SelectListItem ethnicGroup in ViewBag.EthnicGroups)
                            {
                                bool selected = Model.EthnicGroup == ethnicGroup.Value;
                                @Html.RadioButtonFor(model => model.EthnicGroup, ethnicGroup.Value, new { data_bind = "checked: patient.EthnicGroup" }) @ethnicGroup.Text          
                            }
                        </div>
                        @Html.ValidationMessageFor(model => model.EthnicGroup)
                    </div>
                    @Html.Label("Code", new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.PostalAddress.PostalCode, new { @class = "form-control", data_bind = "value: patient.PostalAddress.PostalCode" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PostalAddress.PostalCode)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.MobileNumber, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.MobileNumber, new { @class = "form-control", data_bind = "value: patient.MobileNumber" })
                        </div>
                        @Html.ValidationMessageFor(model => model.MobileNumber)
                    </div>
                    <div class="col-sm-offset-2 col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.PostalAddress.City, new { @class = "form-control", data_bind = "value: patient.PostalAddress.City" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PostalAddress.City)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.EmailAddress, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.TextBoxFor(model => model.EmailAddress, new { @class = "form-control", data_bind = "value: patient.EmailAddress" })
                        </div>
                        @Html.ValidationMessageFor(model => model.EmailAddress)
                    </div>
                    <div class="col-sm-offset-2 col-sm-4">
                        <div class="col-xs-8">
                            @Html.DropDownListFor(model => model.PostalAddress.ProvinceId, ViewBag.Provinces as SelectList, "-- Please select a province --", new { id = "ddlPostalAddressProvinceId", @class = "form-control", data_bind = "value: patient.PostalAddress.ProvinceId" })
                        </div>
                        @Html.ValidationMessageFor(model => model.PostalAddress.ProvinceId)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.HomeTelephoneNumber, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.Label("(")
                            @Html.TextBoxFor(model => model.HomeTelephoneCode, new { @class = "smallerinput form-control", data_bind = "value: patient.HomeTelephoneCode" })
                            @Html.Label(")")
                            @Html.TextBoxFor(model => model.HomeTelephoneNumber, new { @class = "smallinput form-control", data_bind = "value: patient.HomeTelephoneNumber" })
                        </div>
                        @Html.ValidationMessageFor(model => model.HomeTelephoneCode)
                        @Html.ValidationMessageFor(model => model.HomeTelephoneNumber)
                    </div>
                    @Html.LabelFor(model => model.PrefferedContactMethod, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @foreach (SelectListItem preferredContactMethod in ViewBag.PrefferedContactTypes)
                            {
                                bool selected = Model.PrefferedContactMethod == preferredContactMethod.Value;
                                @Html.RadioButtonFor(model => model.PrefferedContactMethod, preferredContactMethod.Value, new { data_bind = "checked: patient.PrefferedContactMethod" }) @preferredContactMethod.Text<br />        
                            }
                        </div>
                        @Html.ValidationMessageFor(model => model.PrefferedContactMethod)
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.WorkTelephoneNumber, new { @class = "col-sm-2 control-label" })
                    <div class="col-sm-4">
                        <div class="col-xs-8">
                            @Html.Label("(")
                            @Html.TextBoxFor(model => model.WorkTelephoneCode, new { @class = "smallerinput form-control", data_bind = "value: patient.WorkTelephoneCode" })
                            @Html.Label(")")
                            @Html.TextBoxFor(model => model.WorkTelephoneNumber, new { @class = "smallinput form-control", data_bind = "value: patient.WorkTelephoneNumber" })
                        </div>
                        @Html.ValidationMessageFor(model => model.WorkTelephoneCode)
                        @Html.ValidationMessageFor(model => model.WorkTelephoneNumber)
                    </div>
                    <div class="col-sm-offset-2 col-sm-4">
                        <div class="col-xs-8">
                        </div>
                    </div>
                </div>
                <div class="formcontent container-fluid">
                    <div class="form-group">
                        @Html.LabelFor(model => model.MedicalAidInd, new { @class = "col-sm-2 control-label" })
                        <div class="col-sm-10">
                            <div class="col-xs-8">
                                @Html.CheckBoxFor(model => model.MedicalAidInd, new { data_bind = "checked: patient.MedicalAidInd, event: { click: displayMedicalDetails }" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="formcontent container-fluid" data-bind="visible: patient.MedicalAidInd">
                    <div class="form-group" id="divMedicalAidName">
                        @Html.LabelFor(model => model.MedicalAidName, new { @class = "col-sm-2 control-label" })
                        <div class="col-sm-4">
                            <div class="col-xs-8">
                                @Html.TextBoxFor(model => model.MedicalAidName, new { @class = "form-control", data_bind = "value: patient.MedicalAidName" })
                            </div>
                            @Html.ValidationMessageFor(model => model.MedicalAidName)
                        </div>
                        @Html.LabelFor(model => model.MedicalAidScheme, new { @class = "col-sm-2 control-label" })
                        <div class="col-sm-4">
                            <div class="col-xs-8">
                                @Html.TextBoxFor(model => model.MedicalAidScheme, new { @class = "form-control", data_bind = "value: patient.MedicalAidScheme" })
                            </div>
                            @Html.ValidationMessageFor(model => model.MedicalAidScheme)
                        </div>
                    </div>
                    <div class="form-group" id="divMedicalAidNumber">
                        @Html.LabelFor(model => model.MedicalAidNumber, new { @class = "col-sm-2 control-label" })
                        <div class="col-sm-4">
                            <div class="col-xs-8">
                                @Html.TextBoxFor(model => model.MedicalAidNumber, new { @class = "form-control", data_bind = "value: patient.MedicalAidNumber" })
                            </div>
                            @Html.ValidationMessageFor(model => model.MedicalAidNumber)
                        </div>
                        @Html.LabelFor(model => model.PrincipalMemberInd, new { @class = "col-sm-2 control-label" })
                        <div class="col-sm-4">
                            <div class="col-xs-8">
                                @Html.CheckBoxFor(model => model.PrincipalMemberInd, new { data_bind = "checked: patient.PrincipalMemberInd" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="formcontent container-fluid">
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            @Html.ValidationSummary(true)
                        </div>
                    </div>
                    <div class="form-group buttons">
                        <div class="col-sm-offset-5 col-sm-7">
                            <input type="submit" value="Save" id="btnSave" name="Command" class="btn btn-primary btn-sm" 
                                   data-bind="@("click: function(data, event) { save(data, event, '" + @Url.Action("SavePatient", "Patient", new { area = "PatientManagement" }) + "', 'frmSavePatient', 'divPatientDetails')}")" />
                            <input type="submit" value="Print" id="btnPrint" name="Command" class="btn btn-primary btn-sm" 
                                   data-bind="@("click: function(data, event) { print(data, event, '" + @Url.Action("PrintPatientSchedule", "Patient", new { area = "PatientManagement" }) + "', '" + @Url.Action("SavePatient", "Patient", new { area = "PatientManagement" }) + "', 'frmSavePatient', 'divPatientDetails')}")" />
                            <input type="submit" value="Create Consultation" id="btnCreateConsultation" name="Command" class="btn btn-primary btn-sm" 
                                   data-bind="@("click: function(data, event) { createconsultation(data, event, '" + @Url.Action("PatientConsultation", "PatientConsultation", new { area = "PatientManagement" }) + "', '" + @Url.Action("SavePatient", "Patient", new { area = "PatientManagement" }) + "', 'frmSavePatient', 'divPatientDetails')}")"/>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </form>

    <div data-bind="visible: patient.MedicalAidInd">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <a data-dialog-title="Patient Medical Aid Dependency" class="ShowPopupForm"
                    data-bind="@("click: function (data, event) { $root.addmedicalaiddependancy(data, event, 'patientdependancydialog', '" + @Url.Action("PatientMedicalAidDependancyView", "Patient", new { area = "PatientManagement" }) + "')}")"
                    ><span class="glyphicon glyphicon-plus"></span></a>
                Medical Aid Dependancies Details
            </div>
            <div class="panel-body" data-bind='foreach: patientmedicaldependancies'>
                <div class="col-md-offset-1 col-md-3">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <a data-dialog-title="Patient Medical Aid Dependency" class="EditPopupForm glyphicon glyphicon-pencil"
                               data-bind="@("click: function (data, event) { $root.editmedicalaiddependancy(data, event, 'patientdependancydialog', '" + @Url.Action("PatientMedicalAidDependancyView", "Patient", new { area = "PatientManagement" }) + "')}")"></a>
                            <a data-dialog-title="Patient Medical Aid Dependency" class="DeletePopupForm glyphicon glyphicon-remove"
                               data-bind="@("click: function (data, event) { $root.deletemedicalaiddependancy(data, event, 'patientdependancydialog', '" + @Url.Action("DeletePatientMedicalAidDependancy", "Patient", new { area = "PatientManagement" }) + "')}")"></a>
                        </div>
                        <div class="panel-body">
                            <div data-bind="text: fullName"></div>
                            <div data-bind="text: BirthDate"></div>
                            <div data-bind="text: Relationship"></div>
                            <div data-bind="text: MedicalAidCode"></div>
                            <div><b>Principal Member: </b><span data-bind="  text: isPrincipalMember"></span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

<div id="patientdependancydialog" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="ModalHeader" aria-hidden="true">
</div>


<div id="divGetPatientViewModelUrl" data-url="@Url.Action("GetPatient", "Patient", new { area = "PatientManagement" })"></div>
<div id="divSavePatientUrl" data-url="@Url.Action("SavePatient", "Patient", new { area = "PatientManagement" })"></div>

